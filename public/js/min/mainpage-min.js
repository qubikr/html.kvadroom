$(function(){if($("body").hasClass("main-page")){jQuery.fn.fadeSlideShow=function(t){return this.each(function(){settings=jQuery.extend({width:640,height:480,speed:"slow",interval:3e3,autoplay:!0,load:!1},t),jQuery(this).css({width:settings.width,height:settings.height,position:"relative",overflow:"hidden"}),jQuery("> *",this).css({position:"absolute",width:settings.width,height:settings.height}),jQuery(this).find("img.lazy:eq(0)").each(function(){var t=$(this).attr("data-src");$(this).attr("src",t).removeAttr("data-src")});var e=jQuery("> *",this).length;e-=1;var a=e,i=jQuery("> *",this),s=this,n=!1,r=function(){n=setInterval(function(){i.parent().find("img.lazy:eq("+a+"), img.lazy:eq("+(a-1)+"), img.lazy:eq("+(a+1)+")").each(function(){var t=$(this).attr("data-src");t&&$(this).attr("src",t).removeAttr("data-src")}),i.eq(a).fadeOut(settings.speed),0>=a?(i.fadeIn(settings.speed),a=e):a-=1},settings.interval)},o=function(t){0>t?t=e:t>e&&(t=0),t>=a?jQuery("> *:lt("+(t+1)+")",s).fadeIn(settings.speed):a>=t&&jQuery("> *:gt("+t+")",s).fadeOut(settings.speed),a=t,settings.ListElement&&(jQuery("#"+settings.ListElement+" li").removeClass(settings.ListLiActive),jQuery("#"+settings.ListElement+" li").eq(e-t).addClass(settings.ListLiActive))};if(settings.ListElement){for(var l=0,c="";e>=l;)c=0==l?c+'<li class="'+settings.ListLi+l+" "+settings.ListLiActive+'"><a href="#">'+(l+1)+"</a></li>":c+'<li class="'+settings.ListLi+l+'"><a href="#">'+(l+1)+"</a></li>",l++;var d='<ul id="'+settings.ListElement+'">'+c+"</ul>";settings.addListToId?jQuery("#"+settings.addListToId).append(d):jQuery(this).after(d),jQuery("#"+settings.ListElement+" a").bind("click",function(){var t=jQuery("#"+settings.ListElement+" a").index(this);stopAutoplay();var a=e-t;return o(a),!1})}settings.load(this),settings.autoplay?r():n=!1})};var t={1:{1:"novostroyki"},2:{1:"kupit-kvartiru",2:"sniat-kvartiru",3:"kvartiri-posutochno"},3:{1:"kupit-komnatu",2:"sniat-komnatu",3:"komnati-posutochno"},4:{1:"kupit-taunhaus",2:"sniat-taunhaus"},5:{1:"kupit-dom",2:"sniat-dom",3:"kottedji-posutochno"},6:{1:"zemelnie-uchastki"},7:{1:"garaji-kupit",2:"garaji-sniat"},8:{1:"ofisy-kupit",2:"ofisy-sniat"}},e={getState:function(){return this.data("searchString").searchSelector.hasClass("active")},assume:function(){var t=this.data("searchString");t.searchSelector.hasClass("active")&&t.entryBlock.trigger("keyup")},setCurrentCity:function(t){this.data("searchString").city=t},init:function(t){function e(t,e){e=$.trim(e),e=e.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,""),e.replace(/\s{2,}/g," ");var a=e.split(" ");a.sort(function(t,e){return e.length-t.length});for(var i=0,s=a.length;s>i;i++){var n=new RegExp(a[i],"gi");t=t.replace(n,function(t){return"<span>"+t+"</span>"})}return t}function a(t){if(n.searchSelector.html("").removeClass("active"),t&&t.length>0){var a=0;_.each(t,function(t){if(t&&t.title){var i=$("<li />");i.attr("data-region",n.city),i.attr("data-title_small",t.title_small),i.attr("data-url",t.url),0!=t.main&&i.attr("data-region",t.main),t.title=e(t.title,n.entryBlock.val()),i.html(t.title).data(t).appendTo(n.searchSelector),t.type&&i.addClass(t.type),a++}}),a>0&&n.searchSelector.addClass("active")}}function i(){var e=n.entryBlock.val();cat=$($(".active[data-value]")[1]).data("value"),e=e.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,"");var i=t.dataGetter(e,cat),s=t.url+JSON.stringify(i);e&&e.length>1&&(o[s]?a(o[s]):(console.log(i),$.ajax({url:t.url,data:i,success:function(t){o[s]=t,a(t)}})))}var s=this;s.data("searchString",{entryBlock:$('<input class="entry main-page-search-strings" tabindex="1" placeholder="'+s.data("placeholder")+'" />'),searchSelector:$('<ul class="search-selector" />')});var n=s.data("searchString");s.append(n.entryBlock).after(n.searchSelector),n.entryBlock.css("width",s.data("width"));var r,o={};n.entryBlock.on("keydown",function(t){!$(this).val()&&$.inArray(t.keyCode,[37,38,39,40,13,8])<0&&$(this).prop("placeholder","")}),n.entryBlock.on("keyup",function(t){if(clearTimeout(r),""==$(this).val())return n.searchSelector.removeClass("active"),n.entryBlock.attr("placeholder",n.entryBlock.parent().data("placeholder")),!1;if($.inArray(t.keyCode,[37,38,39,40,13])<0)r=setTimeout(function(){i()},200);else{t.preventDefault();var e=n.searchSelector.find("li.active");40==t.keyCode&&e.next().is("li")&&e.removeClass("active").next().addClass("active"),38==t.keyCode&&e.prev().is("li")&&e.removeClass("active").prev().addClass("active"),13==t.keyCode&&e.click()}}),$(document).on("click.searchString",function(){n.searchSelector.removeClass("active")}),n.entryBlock.on("focus",function(){s.addClass("focused")}),n.entryBlock.on("blur",function(){s.removeClass("focused")}),$(".search-string, .search-selector").on("click",function(t){t.stopPropagation(),n.entryBlock.focus(),""!=n.entryBlock.html()&&n.searchSelector.addClass("active")}),n.searchSelector.on("click.li","li",function(t){var e=$(this).data("title_small");n.searchSelector.find("li").remove(".active"),$(this).addClass("active"),t.stopPropagation(),n.searchSelector.removeClass("active"),n.entryBlock.val(e)})}};$.fn.KVTestSearchString=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?($.error("Method "+t+" does not exist on jQuery.KVSearchString"),this):e.init.apply(this,arguments)},$(".main-page  .sp-wrapper .inner-image img").on("load",function(){$(this).show()});var a=function(t){var e=this,a=_.uniqueId("UIClickOutside_");this.options=$.extend({selector:"",onClickOutside:function(t){}},t),this.bind=function(){this.unbind(),$(document).on("mouseup."+a,function(t){var a=$(e.options.selector);a.is(t.target)||0!==a.has(t.target).length||e.options.onClickOutside(t.target)})},this.unbind=function(){$(document).off("mouseup."+a)}},i=new a({selector:".filter",onClickOutside:function(){$(".search-selector").removeClass("active")}});i.bind(),$(".main-page  .filter").KVTestSearchString({dataGetter:function(t,e){return{text:t,cat:e}},url:"http://www.kvadroom.ru/action/search_text_main/"}),$(".main-page .dropdown").eq(1).find("li").on("mousedown",function(){var e=$(this).data("value"),a=$(".dropdown").eq(0),i=a.find("li"),s=t[e],n=a.find("li.active").index();i.each(function(){$(this).addClass("disabled").removeClass("active")});for(var r in s)i.eq(r-1).removeClass("disabled");a.find("li").eq(n).hasClass("disabled")?a.find("li").not(".disabled").eq(0).addClass("active"):a.find("li").eq(n).addClass("active"),a.find(".title").html(a.find("li.active").text())}),$(".main-page  .dropdown").eq(0).find("li").on("mousedown",function(e){e=event||window.event,$(this).hasClass("disabled")&&(e.preventDefault(),$(this).off("click"));var a=$(".dropdown").eq(1).find("li"),i=$(this).data("value");a.each(function(){$(this).hasClass("disabled")||$(this).addClass("disabled")});for(var s in t)t[s][i]&&a.parent().find('[data-value="'+s+'"]').removeClass("disabled")}),$("div.btn.blue").on("click",function(){var e,a=$(".search-selector li.active").data("url");option1=$($(".active[data-value]")[0]).data("value"),option2=$($(".active[data-value]")[1]).data("value"),e=t[option2][option1];var i=a||"";document.location=i+e}),$(".bgSlider").fadeSlideShow({width:1440,height:560,autoplay:!0,interval:1e4,load:function(t){$(t).css("display","block")}})}});