$(function(){function t(t,i){return e[i][t]||!1}if($("body").hasClass("main-page")){jQuery.fn.fadeSlideShow=function(t){return this.each(function(){settings=jQuery.extend({width:640,height:480,speed:"slow",interval:3e3,autoplay:!0,load:!1},t),jQuery(this).css({width:settings.width,height:settings.height,position:"relative",overflow:"hidden"}),jQuery("> *",this).css({position:"absolute",width:settings.width,height:settings.height}),jQuery(this).find("img.lazy:eq(0)").each(function(){var t=$(this).attr("data-src");$(this).attr("src",t).removeAttr("data-src")});var e=jQuery("> *",this).length;e-=1;var i=e,a=jQuery("> *",this),s=this,n=!1,r=function(){n=setInterval(function(){a.parent().find("img.lazy:eq("+i+"), img.lazy:eq("+(i-1)+"), img.lazy:eq("+(i+1)+")").each(function(){var t=$(this).attr("data-src");t&&$(this).attr("src",t).removeAttr("data-src")}),a.eq(i).fadeOut(settings.speed),0>=i?(a.fadeIn(settings.speed),i=e):i-=1},settings.interval)},o=function(t){0>t?t=e:t>e&&(t=0),t>=i?jQuery("> *:lt("+(t+1)+")",s).fadeIn(settings.speed):i>=t&&jQuery("> *:gt("+t+")",s).fadeOut(settings.speed),i=t,settings.ListElement&&(jQuery("#"+settings.ListElement+" li").removeClass(settings.ListLiActive),jQuery("#"+settings.ListElement+" li").eq(e-t).addClass(settings.ListLiActive))};if(settings.ListElement){for(var l=0,c="";e>=l;)c=0==l?c+'<li class="'+settings.ListLi+l+" "+settings.ListLiActive+'"><a href="#">'+(l+1)+"</a></li>":c+'<li class="'+settings.ListLi+l+'"><a href="#">'+(l+1)+"</a></li>",l++;var d='<ul id="'+settings.ListElement+'">'+c+"</ul>";settings.addListToId?jQuery("#"+settings.addListToId).append(d):jQuery(this).after(d),jQuery("#"+settings.ListElement+" a").bind("click",function(){var t=jQuery("#"+settings.ListElement+" a").index(this);stopAutoplay();var i=e-t;return o(i),!1})}settings.load(this),settings.autoplay?r():n=!1})};var e={1:{1:"novostroyki"},2:{1:"kupit-kvartiru",2:"sniat-kvartiru",3:"kvartiri-posutochno"},3:{1:"kupit-komnatu",2:"sniat-komnatu",3:"komnati-posutochno"},4:{1:"kupit-taunhaus",2:"sniat-taunhaus"},5:{1:"kupit-dom",2:"sniat-dom",3:"kottedji-posutochno"},6:{1:"zemelnie-uchastki"},7:{1:"garaji-kupit",2:"garaji-sniat"},8:{1:"ofisy-kupit",2:"ofisy-sniat"}},i={getState:function(){return this.data("searchString").searchSelector.hasClass("active")},assume:function(){var t=this.data("searchString");t.searchSelector.hasClass("active")&&t.entryBlock.trigger("keyup")},setCurrentCity:function(t){this.data("searchString").city=t},init:function(t){function e(t,e){e=$.trim(e),e=e.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,""),e.replace(/\s{2,}/g," ");var i=e.split(" ");i.sort(function(t,e){return e.length-t.length});for(var a=0,s=i.length;s>a;a++){var n=new RegExp(i[a],"gi");t=t.replace(n,function(t){return"<span>"+t+"</span>"})}return t}function i(t){if(n.searchSelector.html("").removeClass("active"),t&&t.length>0){var i=0;_.each(t,function(t){if(t&&t.title){var a=$("<li />");a.attr("data-region",n.city),a.attr("data-title_small",t.title_small),a.attr("data-url",t.url),0!=t.main&&a.attr("data-region",t.main),t.title=e(t.title,n.entryBlock.val()),a.html(t.title).data(t).appendTo(n.searchSelector),t.type&&a.addClass(t.type),i++}}),i>0&&n.searchSelector.addClass("active")}}function a(){var e=n.entryBlock.val();cat=$($(".active[data-value]")[1]).data("value"),e=e.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,"");var a=t.dataGetter(e,cat),s=t.url+JSON.stringify(a);e&&e.length>1&&(o[s]?i(o[s]):(console.log(a),$.ajax({url:t.url,data:a,success:function(t){o[s]=t,i(t)}})))}var s=this;s.data("searchString",{entryBlock:$('<input class="entry main-page-search-strings" tabindex="1" placeholder="'+s.data("placeholder")+'" />'),searchSelector:$('<ul class="search-selector" />')});var n=s.data("searchString");s.append(n.entryBlock).after(n.searchSelector),n.entryBlock.css("width",s.data("width"));var r,o={};n.entryBlock.on("keydown",function(t){!$(this).val()&&$.inArray(t.keyCode,[37,38,39,40,13,8])<0&&$(this).prop("placeholder","")}),n.entryBlock.on("keyup",function(t){if(clearTimeout(r),""==$(this).val())return n.searchSelector.removeClass("active"),n.entryBlock.attr("placeholder",n.entryBlock.parent().data("placeholder")),!1;if($.inArray(t.keyCode,[37,38,39,40,13])<0)r=setTimeout(function(){a()},200);else{t.preventDefault();var e=n.searchSelector.find("li.active");40==t.keyCode&&e.next().is("li")&&e.removeClass("active").next().addClass("active"),38==t.keyCode&&e.prev().is("li")&&e.removeClass("active").prev().addClass("active"),13==t.keyCode&&e.click()}}),$(document).on("click.searchString",function(){n.searchSelector.removeClass("active")}),n.entryBlock.on("focus",function(){s.addClass("focused")}),n.entryBlock.on("blur",function(){s.removeClass("focused")}),$(".search-string, .search-selector").on("click",function(t){t.stopPropagation(),n.entryBlock.focus(),""!=n.entryBlock.html()&&n.searchSelector.addClass("active")}),n.searchSelector.on("click.li","li",function(t){var e=$(this).data("title_small");n.searchSelector.find("li").remove(".active"),$(this).addClass("active"),t.stopPropagation(),n.searchSelector.removeClass("active"),n.entryBlock.val(e)})}};$.fn.KVTestSearchString=function(t){return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?($.error("Method "+t+" does not exist on jQuery.KVSearchString"),this):i.init.apply(this,arguments)},$(".sp-wrapper .inner-image img").on("load",function(){$(this).show()});var a=function(t){var e=this,i=_.uniqueId("UIClickOutside_");this.options=$.extend({selector:"",onClickOutside:function(t){}},t),this.bind=function(){this.unbind(),$(document).on("mouseup."+i,function(t){var i=$(e.options.selector);i.is(t.target)||0!==i.has(t.target).length||e.options.onClickOutside(t.target)})},this.unbind=function(){$(document).off("mouseup."+i)}},s=new a({selector:".filter",onClickOutside:function(){$(".search-selector").removeClass("active")}});s.bind(),$(".filter").KVTestSearchString({dataGetter:function(t,e){return{text:t,cat:e}},url:"http://www.kvadroom.ru/action/search_text_main/"}),$(".dropdown").eq(1).find("li").on("mousedown",function(){var t=$(this).data("value"),i=$(".dropdown").eq(0),a=i.find("li"),s=e[t],n=i.find("li.active").index();a.each(function(){$(this).addClass("disabled").removeClass("active")});for(var r in s)a.eq(r-1).removeClass("disabled");i.find("li").eq(n).hasClass("disabled")?i.find("li").not(".disabled").eq(0).addClass("active"):i.find("li").eq(n).addClass("active"),i.find(".title").html(i.find("li.active").text())}),$("div.btn.blue").on("click",function(){var t,i=$(".search-selector li.active").data("url");option1=$($(".active[data-value]")[0]).data("value"),option2=$($(".active[data-value]")[1]).data("value"),t=e[option2][option1];var a=i||"";document.location=a+t}),$(".bgSlider").fadeSlideShow({width:1440,height:560,autoplay:!0,interval:1e4,load:function(t){$(t).css("display","block")}})}});