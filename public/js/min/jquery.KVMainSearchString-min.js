!function($){var t='[{"title":"ЖК «Первый Московский» <em>Московский</em>","type":"city","wagons":[{"id":"252482","type":"city","data":{"title":"ЖК «Первый Московский»"}}]},{"title":"ЖК «Ново-Молоково» <em>Ленинский район</em>","type":"city","wagons":[{"id":"252461","type":"city","data":{"title":"ЖК «Ново-Молоково»"}}]},{"title":"ЖК «Град Московский» <em>Московский</em>","type":"city","wagons":[{"id":"252391","type":"city","data":{"title":"ЖК «Град Московский»"}}]},{"title":"Можайск <em>Можайский район</em>","type":"city","wagons":[{"id":"3934","type":"city","data":{"title":"Можайск"}}]},{"title":"д. Москворецкая Слобода <em>Можайский район</em>","type":"city","wagons":[{"id":"13312","type":"city","data":{"title":"д. Москворецкая Слобода"}}]},{"title":"Можайск <em>Белорусское напр.</em>","type":"railway","wagons":[{"id":"61","type":"railway","data":{"title":"Можайск","group_id":"1190"}}]},{"title":"Московский <em>Новомосковский АО</em>","type":"city","wagons":[{"id":"7170","type":"city","data":{"title":"Московский"}}]},{"title":"п. Завод Мосрентген <em>Новомосковский АО</em>","type":"city","wagons":[{"id":"12826","type":"city","data":{"title":"п. Завод Мосрентген"}}]},{"title":"с. Мокрое <em>Можайский район</em>","type":"city","wagons":[{"id":"13310","type":"city","data":{"title":"с. Мокрое"}}]},{"title":"СНТ «Московский Трубный завод» <em>Новомосковский АО</em>","type":"city","wagons":[{"id":"256650","type":"city","data":{"title":"СНТ «Московский Трубный завод»"}}]},{"title":"Можайск гп <em>Можайский район</em>","type":"city","wagons":[{"id":"10499","type":"city","data":{"title":"Можайск гп"}}]},{"title":"с. Молоково <em>Ленинский район</em>","type":"city","wagons":[{"id":"12825","type":"city","data":{"title":"с. Молоково"}}]},{"title":"д. Моденово <em>Можайский район</em>","type":"city","wagons":[{"id":"13309","type":"city","data":{"title":"д. Моденово"}}]},{"title":"д. Мордвиново <em>Можайский район</em>","type":"city","wagons":[{"id":"13311","type":"city","data":{"title":"д. Мордвиново"}}]},{"title":"д. Мотягино <em>Можайский район</em>","type":"city","wagons":[{"id":"13313","type":"city","data":{"title":"д. Мотягино"}}]},{"title":"с. Мочилы <em>Серебряно-Прудский район</em>","type":"city","wagons":[{"id":"15520","type":"city","data":{"title":"с. Мочилы"}}]},{"title":"пгт. Монино <em>Щелковский район</em>","type":"city","wagons":[{"id":"16832","type":"city","data":{"title":"пгт. Монино"}}]},{"title":"БЦ «Можайский (B)» <em>Западный АО</em>","type":"city","wagons":[{"id":"254993","type":"city","data":{"title":"БЦ «Можайский (B)»"}}]},{"title":"СНТ «Серп и Молот» <em>Домодедово</em>","type":"city","wagons":[{"id":"256708","type":"city","data":{"title":"СНТ «Серп и Молот»"}}]},{"title":"Москва Белорусская <em>Белорусское напр.</em>","type":"railway","wagons":[{"id":"11","type":"railway","data":{"title":"Москва Белорусская","group_id":"1190"}}]},{"title":"Москва Курская <em>Горьковское напр.</em>","type":"railway","wagons":[{"id":"82","type":"railway","data":{"title":"Москва Курская","group_id":"1192"}}]},{"title":"Серп и Молот <em>Горьковское напр.</em>","type":"railway","wagons":[{"id":"83","type":"railway","data":{"title":"Серп и Молот","group_id":"1192"}}]}]',e={getState:function(){return this.data("filter").searchSelector.hasClass("active")},assume:function(){var t=this.data("filter");t.searchSelector.hasClass("active")&&t.entryBlock.trigger("keyup")},setCurrentCity:function(t){this.data("filter").city=t},init:function(e){function a(t,e){e=$.trim(e),e=e.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,""),e.replace(/\s{2,}/g," ");var a=e.split(" ");a.sort(function(t,e){return e.length-t.length});for(var i=0,r=a.length;r>i;i++){var l=new RegExp(a[i],"gi");t=t.replace(l,function(t){return"<span>"+t+"</span>"})}return t}function i(t){var t=t.slice(0,11),e=t.length;e>10?c.caret.show():c.caret.hide();var i=10,r=t.slice(0,i);if(c.searchSelector.html(""),c.wrapper.removeClass("active"),t&&t.length>0){var e=0;$.each(t,function(t,i){if(i&&i.title){var r=$("<li />");r.attr("data-region",c.city),i.title=a(i.title,c.entryBlock.val()),r.html(i.title).data(i).appendTo(c.searchSelector),i.type&&r.addClass(i.type),e++}}),e>0&&(c.searchSelector.find("li").eq(0).addClass("active"),c.wrapper.addClass("active"))}}function r(){var a=c.entryBlock.val();a=a.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,"");var r=e.dataGetter(a),l=e.url+JSON.stringify(r);a&&a.length>1&&(s[l]?i(s[l]):(s[l]=t,console.log(r),i(JSON.parse(t))))}var l=this;l.data("searchString",{entryBlock:$('<input class="entry main-page-search-strings" tabindex="1" placeholder="'+l.data("placeholder")+'" />'),searchSelector:$('<ul class="collapsed search-selector"></ul>'),wrapper:$('<div class="search-results"></div>'),caret:$('<div class="hide expand-caret">Показать все</div>')});var c=l.data("searchString");l.append(c.entryBlock).after(c.wrapper),c.wrapper.append(c.searchSelector),c.wrapper.append(c.caret),c.entryBlock.css("width",l.data("width"));var n,s={};c.entryBlock.on("keydown",function(t){!$(this).val()&&$.inArray(t.keyCode,[37,38,39,40,13,8])<0&&$(this).prop("placeholder","")}),c.entryBlock.on("keyup",function(t){if(clearTimeout(n),""==$(this).val())return c.wrapper.removeClass("active"),c.entryBlock.attr("placeholder",c.entryBlock.parent().data("placeholder")),!1;if($.inArray(t.keyCode,[37,38,39,40,13])<0)n=setTimeout(function(){r()},200);else{t.preventDefault();var e=c.searchSelector.find("li.active");40==t.keyCode&&e.next().is("li")&&e.removeClass("active").next().addClass("active"),38==t.keyCode&&e.prev().is("li")&&e.removeClass("active").prev().addClass("active"),13==t.keyCode&&e.click()}}),$(document).on("click.filter",function(){c.searchSelector.removeClass("active")}),c.entryBlock.on("focus",function(){l.addClass("focused")}),c.entryBlock.on("blur",function(){l.removeClass("focused")}),$(".filter, .search-selector").on("click",function(t){t.stopPropagation(),c.entryBlock.focus(),""!=c.entryBlock.html()&&c.searchSelector.addClass("active")}),c.searchSelector.on("click.li","li",function(t){var e=$(this).data(),a=e.title.replace(/<[\/]?[span|em][^>]*>/g,"");t.stopPropagation(),c.searchSelector.removeClass("active"),c.entryBlock.val(a)})}};$.fn.KVTestSearchString=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?($.error("Method "+t+" does not exist on jQuery.KVSearchString"),this):e.init.apply(this,arguments)}}(jQuery);