!function($){var e={collapse:function(){return this.find("input.entry").prop("placeholder","").css("width",40),this},expand:function(){return this.find("input.entry").prop("placeholder",this.data("placeholder")).css("width",this.data("width")),this},getState:function(){return this.data("searchString").searchSelector.hasClass("active")},assume:function(){var e=this.data("searchString");e.searchSelector.hasClass("active")&&e.entryBlock.trigger("keyup")},setCurrentCity:function(e){this.data("searchString").city=e},init:function(e){function t(e,t){t=$.trim(t),t=t.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,""),t.replace(/\s{2,}/g," ");var a=t.split(" ");a.sort(function(e,t){return t.length-e.length});for(var r=0,c=a.length;c>r;r++){var n=new RegExp(a[r],"gi");e=e.replace(n,function(e){return"<span>"+e+"</span>"})}return e}function a(e){if(n.searchSelector.html("").removeClass("active"),e&&e.length>0){var a=0;$.each(e,function(e,r){if(r&&r.title){var c=$("<li />");c.attr("data-region",n.city),r.title=t(r.title,n.entryBlock.val()),c.html(r.title).data(r).appendTo(n.searchSelector),r.type&&c.addClass(r.type),a++}}),a>0&&(n.searchSelector.find("li").eq(0).addClass("active"),n.searchSelector.addClass("active"))}}function r(){var t=n.entryBlock.val();t=t.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,"");var r=e.dataGetter(t),c=e.url+JSON.stringify(r);t&&t.length>1&&(s[c]?a(s[c]):$.ajax({url:e.url,data:r,success:function(e){s[c]=e,a(e)}}))}var c=this;c.data("searchString",{entryBlock:$('<input class="entry main-page-search-strings" tabindex="1" placeholder="'+c.data("placeholder")+'" />'),searchSelector:$('<ul class="search-selector" />'),train:$('<span class="train" />')});var n=c.data("searchString");c.append(n.entryBlock,n.train).after(n.searchSelector),n.entryBlock.css("width",c.data("width")),n.entryBlock.autosizeInput();var i,s={};n.entryBlock.on("keydown",function(e){!$(this).val()&&$.inArray(e.keyCode,[37,38,39,40,13,8])<0&&($(this).prop("placeholder",""),$(this).css("width",40))}),n.entryBlock.on("keyup",function(e){if(clearTimeout(i),""==$(this).val())return n.searchSelector.removeClass("active"),0==n.train.children().length&&n.entryBlock.val("").css("width",c.data("width")).prop("placeholder",c.data("placeholder")),!1;if($.inArray(e.keyCode,[37,38,39,40,13])<0)i=setTimeout(function(){r()},200);else{e.preventDefault();var t=n.searchSelector.find("li.active");40==e.keyCode&&t.next().is("li")&&t.removeClass("active").next().addClass("active"),38==e.keyCode&&t.prev().is("li")&&t.removeClass("active").prev().addClass("active"),13==e.keyCode&&t.click()}}),$(document).on("click.searchString",function(){n.searchSelector.removeClass("active")}),n.entryBlock.on("focus",function(){c.addClass("focused")}),n.entryBlock.on("blur",function(){c.removeClass("focused")}),$(".search-string, .search-selector").on("click",function(e){e.stopPropagation(),n.entryBlock.focus(),""!=n.entryBlock.html()&&n.searchSelector.addClass("active")}),n.searchSelector.on("click.li","li",function(e){e.stopPropagation(),n.searchSelector.removeClass("active"),n.entryBlock.val("").css("width",50).prop("placeholder",""),c.trigger("select",$(this).data())})}};$.fn.KVTestSearchString=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?($.error("Method "+t+" does not exist on jQuery.KVSearchString"),this):e.init.apply(this,arguments)}}(jQuery);