var GeoMap=function(n){var o=this,e,a=$.extend({id:"map",center:[55.76,37.64],zoom:10,layer:"map",onInit:function(){}},n),t=function(){e=new ymaps.Map(a.id,{center:a.center,zoom:a.zoom})},i=function(n,o,a,t,i,c){var s=this,d=_.uniqueId("balloon"),l=$(),r=!1,f=new ymaps.Placemark(n,{iconContent:'<div class="map-balloon disabled" id="'+d+'"><div class="inner">'+o+"</div></div>"},{iconImageHref:"",iconImageSize:20,iconImageOffset:10,zIndex:2});f.events.add("overlaychange",function(){l=$("#"+d),l.css({marginTop:-(l.height()/2-(i?i:0)),marginLeft:c?c:0}),a&&a()}),f.events.add("click",function(){t&&t()}),e.geoObjects.add(f);var u=function(){s.hide()};this.show=function(n){l.removeClass("disabled"),e.events.add("click",u),r!==!0&&(r=n)},this.hide=function(){r!==!0&&(l.addClass("disabled"),e.events.remove("click",u))}};this.Pin=function(n){var o=$.extend({center:[55.76,37.64],content:"",onReady:function(){},onBalloonReady:function(){},onBalloonClick:function(){}},n),a=new ymaps.Placemark(o.center,{iconContent:'<span class="maps-marker-icon maps-marker-basic"></span>'},{iconImageHref:"",iconImageSize:[31,43],iconImageOffset:[-21,-49]});e.geoObjects.add(a);var t=new i(o.center,o.content,o.onBalloonReady,o.onBalloonClick,-25,18);a.events.add("click",function(){e.panTo(o.center,{delay:0}),t.show()}),a.events.add("overlaychange",function(){o.onReady&&o.onReady()}),this.pointMap=function(){e.setCenter(o.center)},this.showBalloon=function(n){t.show(n)},this.hideBalloon=function(){t.hide()}},this.Area=function(n){var o=$.extend({coords:null,content:"",onReady:function(){},onBalloonReady:function(){},onBalloonClick:function(){}},n),a=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:o.coords,fillRule:"nonZero"}},{fillColor:"rgba(255, 0, 0, 0.1)",strokeColor:"rgba(255, 0, 0, 1)",opacity:1,strokeWidth:2});e.geoObjects.add(a);var t=a.geometry.getBounds(),c=[t[0][0]+(t[1][0]-t[0][0])/2,t[0][1]+(t[1][1]-t[0][1])/2],s=[c[0],t[1][1]],d=new i(s,o.content,o.onBalloonReady,o.onBalloonClick);a.events.add("click",function(){e.panTo(c,{delay:0}),d.show()}),a.events.add("overlaychange",function(){o.onReady&&o.onReady()}),this.pointMap=function(){e.setCenter(c)},this.showBalloon=function(n){d.show(n)},this.hideBalloon=function(){d.hide()}},this.init=function(){"undefined"!=typeof ymaps?(t(),a.onInit(o)):$.getScript("http://api-maps.yandex.ru/2.0-stable/?load=package.full&lang=ru-RU",function(){ymaps.ready(function(){t(),a.onInit(o)})})}};