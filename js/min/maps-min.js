var GeoMap=function(n){var e=this,o,t=[],i=$.extend({id:"map",center:[55.76,37.64],zoom:10,layer:"map",onInit:function(){}},n),a=function(){o=new ymaps.Map(i.id,{center:i.center,zoom:i.zoom})},c=function(n,e,i,a,c,l){var s=this,d=_.uniqueId("balloon"),r=$(),u=!1,f=new ymaps.Placemark(n,{iconContent:'<div class="map-balloon disabled" id="'+d+'"><div class="inner">'+e+"</div></div>"},{iconImageHref:"",iconImageSize:20,iconImageOffset:10,zIndex:2});f.events.add("overlaychange",function(){r=$("#"+d),r.css({marginTop:-(r.height()/2-(c?c:0)),marginLeft:l?l:0}),i&&i()}),f.events.add("click",function(){a&&a()}),o.geoObjects.add(f);var h=function(){s.hide()};this.getId=function(){return d},this.show=function(n){r.removeClass("disabled"),o.events.add("click",h),_.each(t,function(n){n.getId()!=s.getId()&&n.hide()}),u!==!0&&(u=n)},this.hide=function(){u!==!0&&(r.addClass("disabled"),o.events.remove("click",h))},t.push(this)};this.Pin=function(n){var e=$.extend({center:[55.76,37.64],content:"",title:"",onReady:function(){},onClick:function(){},onBalloonReady:function(){},onBalloonClick:function(){}},n),t=_.uniqueId("pin"),i=e.title?'<span class="marker-title">'+e.title+"</span>":"",a=$(),l=new ymaps.Placemark(e.center,{iconContent:'<span class="maps-marker-icon maps-marker-basic" id="'+t+'">'+i+"</span>"},{iconImageHref:"",iconImageSize:[31,43],iconImageOffset:[-21,-49]});o.geoObjects.add(l);var s=null;e.content&&(s=new c(e.center,e.content,e.onBalloonReady,e.onBalloonClick,-25,18)),l.events.add("click",function(){o.panTo(e.center,{delay:0}),e.onClick(),s&&s.show()}),l.events.add("overlaychange",function(){e.onReady&&e.onReady(),a=$("#"+t);var n=a.find(".marker-title");n.css({bottom:-n.outerHeight()})}),this.pointMap=function(){o.setCenter(e.center)},this.showBalloon=function(n){s&&s.show(n)},this.hideBalloon=function(){s&&s.hide()}},this.Area=function(n){var e=$.extend({coords:[],content:"",onReady:function(){},onClick:function(){},onBalloonReady:function(){},onBalloonClick:function(){}},n),t=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:e.coords,fillRule:"nonZero"}},{fillColor:"rgba(255, 0, 0, 0.1)",strokeColor:"rgba(255, 0, 0, 1)",opacity:1,strokeWidth:2});o.geoObjects.add(t);var i=t.geometry.getBounds(),a=null,l=[i[0][0]+(i[1][0]-i[0][0])/2,i[0][1]+(i[1][1]-i[0][1])/2];if(e.content){var s=[l[0],i[1][1]];a=new c(s,e.content,e.onBalloonReady,e.onBalloonClick)}t.events.add("click",function(){o.panTo(l,{delay:0}),e.onClick(),a&&a.show()}),t.events.add("overlaychange",function(){e.onReady&&e.onReady()}),this.pointMap=function(){o.setCenter(l)},this.showBalloon=function(n){a&&a.show(n)},this.hideBalloon=function(){a&&a.hide()}},this.init=function(){"undefined"!=typeof ymaps?(a(),i.onInit(e)):$.getScript("http://api-maps.yandex.ru/2.0-stable/?load=package.full&lang=ru-RU",function(){ymaps.ready(function(){a(),i.onInit(e)})})}};