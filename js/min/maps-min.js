var GeoMap=function(n){var e=this,o,t=$.extend({id:"map",center:[55.76,37.64],zoom:10,layer:"map",onInit:function(){}},n),a=function(){o=new ymaps.Map(t.id,{center:t.center,zoom:t.zoom})},i=function(n,e,t){var a=this,i=_.uniqueId("balloon"),d=$(),c=!1,s=new ymaps.Placemark(n,{iconContent:'<div class="map-balloon disabled" id="'+i+'"><div class="inner">'+e+"</div></div>"},{iconImageHref:"",iconImageSize:20,iconImageOffset:10,zIndex:2});s.events.add("overlaychange",function(){d=$("#"+i),d.css({marginTop:-d.height()/2}),t&&t()}),o.geoObjects.add(s);var l=function(){a.hide()};this.show=function(n){d.removeClass("disabled"),o.events.add("click",l),c!==!0&&(c=n)},this.hide=function(){c!==!0&&(d.addClass("disabled"),o.events.remove("click",l))}};this.Area=function(n){var e=$.extend({coords:[[[55.75,37.8],[55.8,37.9],[55.75,38],[55.7,38],[55.7,37.8]]],content:"",onReady:function(){},onBalloonReady:function(){}},n),t=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:e.coords,fillRule:"nonZero"}},{fillColor:"rgba(255, 0, 0, 0.1)",strokeColor:"rgba(255, 0, 0, 1)",opacity:1,strokeWidth:2});o.geoObjects.add(t);var a=t.geometry.getBounds(),d=[a[0][0]+(a[1][0]-a[0][0])/2,a[0][1]+(a[1][1]-a[0][1])/2],c=[d[0],a[1][1]],s=new i(c,e.content,e.onBalloonReady);t.events.add("click",function(){o.panTo(d,{delay:0}),s.show()}),t.events.add("overlaychange",function(){e.onReady&&e.onReady()}),this.pointMap=function(){o.setCenter(d)},this.showBalloon=function(n){s.show(n)},this.hideBalloon=function(){s.hide()}},this.init=function(){"undefined"!=typeof ymaps?(a(),t.onInit(e)):$.getScript("http://api-maps.yandex.ru/2.0-stable/?load=package.full&lang=ru-RU",function(){ymaps.ready(function(){a(),t.onInit(e)})})}};