var GeoMap=function(n){var o=this,e,a=$.extend({id:"map",center:[55.76,37.64],zoom:10,layer:"map",onInit:function(){}},n),t=function(){e=new ymaps.Map(a.id,{center:a.center,zoom:a.zoom})},i=function(n,o,a){var t=this,i=_.uniqueId("balloon"),d=$(),c=!1,s=new ymaps.Placemark(n,{iconContent:'<div class="map-balloon disabled" id="'+i+'"><div class="inner">'+o+"</div></div>"},{iconImageHref:"",iconImageSize:20,iconImageOffset:10,zIndex:2});s.events.add("overlaychange",function(){d=$("#"+i),d.css({marginTop:-d.height()/2}),a&&a()}),e.geoObjects.add(s);var l=function(){t.hide()};this.show=function(n){d.removeClass("disabled"),e.events.add("click",l),c!==!0&&(c=n)},this.hide=function(){c!==!0&&(d.addClass("disabled"),e.events.remove("click",l))}};this.Area=function(n){var o=$.extend({coords:[[[55.75,37.8],[55.8,37.9],[55.75,38],[55.7,38],[55.7,37.8]]],content:"",onReady:function(){},onBalloonReady:function(){}},n),a=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:o.coords,fillRule:"nonZero"}},{fillColor:"rgba(255, 0, 0, 0.1)",strokeColor:"rgba(255, 0, 0, 1)",opacity:1,strokeWidth:2});e.geoObjects.add(a);var t=a.geometry.getBounds(),d=[];d[0]=t[0][0]+(t[1][0]-t[0][0])/2,d[1]=t[0][1]+(t[1][1]-t[0][1])/2;var c=[d[0],t[1][1]];console.log(d,c,t[1][1]);var s=new i(c,o.content,o.onBalloonReady);a.events.add("click",function(){e.panTo(d,{delay:0}),s.show()}),a.events.add("overlaychange",function(){o.onReady&&o.onReady()}),this.pointMap=function(){e.setCenter(d)},this.showBalloon=function(n){s.show(n)},this.hideBalloon=function(){s.hide()}},this.init=function(){"undefined"!=typeof ymaps?(t(),a.onInit(o)):$.getScript("http://api-maps.yandex.ru/2.0-stable/?load=package.full&lang=ru-RU",function(){ymaps.ready(function(){t(),a.onInit(o)})})}};