var ZKCatalog={};ZKCatalog.Search=function(){this.init=function(){function t(t,e){a.set("items",e),a.set("query",t)}function e(e){e&&e.length>2?ZKCatalog.data.getObjects(function(n){if(n.success){var a=n.objects,o=_.filter(a,function(t){var n=t.name.toLowerCase(),a=e.toLowerCase();return console.log(n.search(a)),n.search(a)>0?t:void 0});t(e,o)}else t(e,{})}):t(e,{})}var n={},a=new Ractive({el:"#search-result",template:'<ul class="search-selector {{#if items.length > 0}}active{{/if}}">{{#items}}<li on-click="goUrl">{{{hl(name, query)}}}</li>{{/items}}</ul>',data:{hl:function(t,e){e=$.trim(e),e=e.replace(/[\.,\/#!$%\^&\*;:"'(){}=_`~()]/g,""),e.replace(/\s{2,}/g," ");var n=e.split(" ");n.sort(function(t,e){return e.length-t.length});for(var a=0,o=n.length;o>a;a++){var i=new RegExp(n[a],"gi");t=t.replace(i,function(t){return"<span>"+t+"</span>"})}return t},query:"",items:[]}});return a.on("goUrl",function(t){window.open(t.context.url,"_blank")}),$(".search-string-zk input.entry").on("keyup",function(t){e(27==t.keyCode?"":$(this).val())}),this}},ZKCatalog.Data=function(){var t=null,e=null;this.getCurrentObject=function(t){return e?t(e):void $.ajax({url:"json/zk.json",data:{},dataType:"json",success:function(n){e=n,t(n)}})},this.getObjects=function(e){return t?e(t):void $.ajax({url:"json/zk_objects.json",data:{},dataType:"json",success:function(n){t=n,e(n)}})}},ZKCatalog.Map=function(){this.init=function(){var t=$(".map-zk-catalog").data();if(t&&t.center){var e=new GeoMap({id:"map-zk-catalog",fullScreenTrigger:"#fullscreen-trigger",zoom:5,clusterer:!0,controls:!0,center:t.center,onInit:function(t){ZKCatalog.data.getCurrentObject(function(t){if(t.success)var n=new e.Pin({type:"basic",avoidClusterer:!0,center:[parseFloat(t.data.lat),parseFloat(t.data.lon)],balloonCloseButton:!0,content:'<a href="'+t.data.url+'">'+t.data.name+"</a>"})}),ZKCatalog.data.getObjects(function(n){console.log(n),n.success&&_.each(n.objects,function(t){new e.Pin({type:"basic_small",center:[parseFloat(t.lat),parseFloat(t.lon)],balloonCloseButton:!0,content:'<a href="'+t.url+'">'+t.name+"</a>"})}),t.fitCluster()})}});e.init()}return this}},ZKCatalog.init=function(){this.data=new this.Data,this.map=(new this.Map).init(),this.search=(new this.Search).init()},$(function(){ZKCatalog.init()});